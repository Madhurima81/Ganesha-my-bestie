<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Ganesha Game</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #f0f0f0;
            margin: 0;
            padding: 10px;
            overflow: hidden;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }
        
        .game-container {
            position: relative;
            width: 800px;
            height: 500px;
            margin: 0 auto;
            overflow: hidden;
            box-shadow: 0 0 20px rgba(0,0,0,0.2);
            border-radius: 8px;
        }
        
        .game-screen {
            position: absolute;
            width: 100%;
            height: 100%;
            background-image: url('/images/backgrounds/forest-basket-background.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            overflow: hidden;
        }
        
        /* Game Elements */
        .modak {
            position: absolute;
            width: 50px; /* Adjusted size */
            height: 50px; /* Adjusted size */
            cursor: grab;
            z-index: 10;
            touch-action: none;
            transition: transform 0.3s ease;
        }
        
        /* Floating animation for modaks */
        @keyframes float {
            0% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
            100% { transform: translateY(0); }
        }
        
        .modak:hover {
            animation: float 1.5s ease-in-out infinite;
        }
        
        .mud-mound {
            position: absolute;
            width: 70px; /* Adjusted size */
            height: 50px; /* Adjusted size */
            background-image: url('/images/items/mud-mound.png');
            background-size: contain;
            background-repeat: no-repeat;
            cursor: pointer;
            z-index: 5;
            transition: transform 0.3s ease;
        }
        
        .mud-mound:hover {
            transform: scale(1.05);
        }
        
        .mooshika {
            position: absolute;
            width: 50px;
            height: 50px;
            visibility: hidden;
            z-index: 4;
        }
        
        /* Jumping animation for mooshika */
        @keyframes jump {
            0% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
            100% { transform: translateY(0); }
        }
        
        .jumping {
            animation: jump 0.5s ease;
            animation-iteration-count: 3; /* Run the animation only 3 times */
        }
        
        .basket {
            position: absolute;
            width: 120px; /* Increased size to fit multiple modaks */
            height: 100px; /* Increased size to fit multiple modaks */
            bottom: 35%; /* Adjusted position */
            right: 20%; /* Adjusted position */
            background-image: url('/images/items/basket.png');
            background-size: contain;
            background-repeat: no-repeat;
            cursor: pointer;
            z-index: 5;
        }
        
        .rock-or-belly {
            position: absolute;
            width: 100px;
            height: 80px;
            bottom: 20%;
            left: 20%; /* Adjusted position */
            background-size: contain;
            background-repeat: no-repeat;
            z-index: 5;
            display: none;
        }
        
        /* Pulse animation for interactive elements */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        /* Glow effect animation */
        @keyframes glow {
            0% { filter: drop-shadow(0 0 2px rgba(255, 215, 0, 0.7)); }
            50% { filter: drop-shadow(0 0 10px rgba(255, 215, 0, 0.9)); }
            100% { filter: drop-shadow(0 0 2px rgba(255, 215, 0, 0.7)); }
        }
        
        .glow-effect {
            animation: glow 1.5s ease infinite;
        }
        
        /* Star burst animation */
        @keyframes star-burst {
            0% { transform: scale(0); opacity: 0; }
            50% { transform: scale(1.5); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .star-burst {
            animation: star-burst 0.5s ease-out forwards;
        }
        
        /* Bounce animation */
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-20px); }
            60% { transform: translateY(-10px); }
        }
        
        .bounce {
            animation: bounce 1s ease;
        }
        
        /* Confetti animation */
        .confetti-container {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 999;
            display: none;
        }
        
        .confetti {
            width: 10px;
            height: 10px;
            position: absolute;
            animation: fall 3s linear forwards;
        }
        
        @keyframes fall {
            to { transform: translateY(100vh) rotate(360deg); }
        }
        
        /* Sidebar */
        .sidebar {
            position: absolute;
            top: 0;
            right: 0;
            width: 55px;
            height: 100%;
            background-image: url('/images/ui/game-sidebar-base.png');
            background-size: cover;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-top: 20px;
            z-index: 20;
        }
        
        .symbol-icon {
            width: 40px;
            height: 40px;
            margin-bottom: 8px;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            transition: transform 0.3s ease;
        }
        
        .symbol-icon:hover {
            transform: scale(1.1);
        }
        
        /* Instructions */
        .game-instructions {
            position: absolute;
            bottom: 10px; /* Keep at bottom */
            left: 50%;
            transform: translateX(-50%);
            width: 70%;
            max-width: 450px;
            padding: 8px;
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 8px;
            text-align: center;
            font-size: 14px;
            z-index: 20;
        }
        
        /* Success Indicator */
        .success-indicator {
            position: absolute;
            top: 40%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            width: 120px;
            height: 120px;
            background-image: url('/images/ui/success-indicator.png');
            background-size: contain;
            background-repeat: no-repeat;
            z-index: 200;
            transition: transform 0.3s ease;
        }
        
        .success-indicator.show {
            transform: translate(-50%, -50%) scale(1);
            animation: glow 1.5s ease;
        }
        
        /* Progress counter */
        .progress-counter {
            position: absolute;
            top: 15px;
            left: 50%;
            transform: translateX(-50%);
            padding: 5px 15px;
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 20px;
            font-size: 16px;
            font-weight: bold;
            z-index: 100;
        }
        
        /* Back and home buttons */
        .back-button, .home-button {
            position: absolute;
            top: 15px;
            width: 40px;
            height: 40px;
            background-size: contain;
            background-repeat: no-repeat;
            cursor: pointer;
            z-index: 100;
            transition: transform 0.2s ease;
        }
        
        .back-button:hover, .home-button:hover {
            transform: scale(1.1);
        }
        
        .back-button {
            left: 15px;
            background-image: url('/images/ui/back-button.png');
        }
        
        .home-button {
            left: 65px;
            background-image: url('/images/ui/home-button.png');
        }
        
        /* Educational Popup */
        .popup-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .popup-content {
            width: 70%;
            max-width: 500px;
            background-image: url('/images/ui/popup-background.png'); /* Using PNG for background */
            background-size: cover;
            background-position: center;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            text-align: center;
            position: relative;
            animation: star-burst 0.5s ease-out;
        }

        .popup-title {
            font-size: 24px;
            color: #8B4513;
            margin-bottom: 15px;
            font-weight: bold;
        }

        .popup-image {
            width: 100px;
            height: 100px;
            object-fit: contain;
            margin: 10px auto;
            display: block;
            animation: glow 2s ease infinite;
        }

        .popup-text {
            font-size: 16px;
            line-height: 1.5;
            margin-bottom: 20px;
            color: #333;
        }

        .close-popup {
            padding: 8px 20px;
            background-color: #8B4513;
            color: white;
            border: none;
            border-radius: 20px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .close-popup:hover {
            background-color: #a0522d;
            transform: scale(1.05);
        }
        
        /* Responsive Design */
        @media (max-width: 820px) {
            .game-container {
                width: 95vw;
                height: calc(95vw * 0.625); /* Maintains 8:5 aspect ratio */
                max-height: 80vh;
            }
            
            .game-instructions {
                font-size: 12px;
                padding: 5px;
            }

            .speech-bubble {
    position: absolute;
    background-color: white;
    border-radius: 20px;
    padding: 10px 15px;
    font-size: 14px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.2);
    z-index: 100;
    opacity: 0;
    transition: opacity 0.3s ease;
    pointer-events: none;
    max-width: 150px;
    text-align: center;
    font-weight: bold;
}

.speech-bubble:after {
    content: '';
    position: absolute;
    bottom: -10px;
    left: 50%;
    transform: translateX(-50%);
    border-width: 10px 10px 0;
    border-style: solid;
    border-color: white transparent transparent;
}

/* Glow effect for rock feeding */
.rock-glow-1 { filter: drop-shadow(0 0 5px rgba(255, 215, 0, 0.5)); }
.rock-glow-2 { filter: drop-shadow(0 0 10px rgba(255, 215, 0, 0.6)); }
.rock-glow-3 { filter: drop-shadow(0 0 15px rgba(255, 215, 0, 0.7)); }
.rock-glow-4 { filter: drop-shadow(0 0 20px rgba(255, 215, 0, 0.8)); }
.rock-glow-5 { filter: drop-shadow(0 0 25px rgba(255, 215, 0, 0.9)); }

/* Celebratory message */
.celebration-message {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(0);
    background-color: rgba(255,255,255,0.9);
    padding: 15px 25px;
    border-radius: 30px;
    font-size: 18px;
    font-weight: bold;
    color: #8B4513;
    box-shadow: 0 4px 20px rgba(0,0,0,0.3);
    z-index: 150;
    text-align: center;
    animation: celebration-appear 1.5s forwards;
}

@keyframes celebration-appear {
    0% { transform: translate(-50%, -50%) scale(0); }
    70% { transform: translate(-50%, -50%) scale(1.1); }
    100% { transform: translate(-50%, -50%) scale(1); }
}

        }
        
        @media (max-height: 520px) {
            .game-container {
                height: 95vh;
                width: calc(95vh * 1.6); /* Maintains 8:5 aspect ratio */
                max-width: 95vw;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="game-screen">
            <!-- Sidebar with icons -->
            <div class="sidebar">
                <div class="symbol-icon" id="symbol-modak" style="background-image: url('/images/icons/symbol-modak-gray.png');"></div>
                <div class="symbol-icon" id="symbol-mooshika" style="background-image: url('/images/icons/symbol-mooshika-gray.png');"></div>
                <div class="symbol-icon" id="symbol-belly" style="background-image: url('/images/icons/symbol-belly-gray.png');"></div>
                <!-- Add other symbol icons as needed -->
            </div>
            
            <!-- Game elements -->
            <!-- 5 Modaks in different positions (moved up to avoid instructions) -->
            <img src="/images/items/modak.png" alt="Modak 1" class="modak" id="modak1" draggable="true" style="top: 40%; left: 10%;">
            <img src="/images/items/modak.png" alt="Modak 2" class="modak" id="modak2" draggable="true" style="top: 50%; left: 20%;">
            <img src="/images/items/modak.png" alt="Modak 3" class="modak" id="modak3" draggable="true" style="top: 45%; left: 35%;">
            <img src="/images/items/modak.png" alt="Modak 4" class="modak" id="modak4" draggable="true" style="top: 55%; left: 45%;">
            <img src="/images/items/modak.png" alt="Modak 5" class="modak" id="modak5" draggable="true" style="top: 40%; left: 60%;">
            
            <!-- 5 Mud Mounds in different positions -->
            <div class="mud-mound" id="mound1" style="top: 60%; left: 15%;"></div>
            <div class="mud-mound" id="mound2" style="top: 65%; left: 30%;"></div>
            <div class="mud-mound" id="mound3" style="top: 70%; left: 50%;"></div>
            <div class="mud-mound" id="mound4" style="top: 65%; left: 65%;"></div>
            <div class="mud-mound" id="mound5" style="top: 60%; left: 80%;"></div>
            
            <!-- Mooshika hidden behind one of the mounds -->
            <img src="/images/characters/mooshika.png" alt="Mooshika" class="mooshika" id="mooshika" style="top: 55%; left: 65%;">
            
            <!-- Basket -->
            <div class="basket" id="basket"></div>
            
            <!-- Rock (initially hidden, appears after 5 modaks in basket) -->
            <div class="rock-or-belly" id="rock-or-belly"></div>
            
            <!-- UI Elements -->
            <div class="progress-counter" id="modak-counter">Modaks: 0/5</div>
            <div class="back-button" id="back-button"></div>
            <div class="home-button" id="home-button"></div>
            <div class="success-indicator" id="success-indicator"></div>
            
            <div class="game-instructions">
                Game 1: Drag 5 modaks to the basket<br>
                Game 2: Find the hidden mooshika behind a mud mound<br>
                Game 3: Feed the rock with modaks from the basket until it turns into a belly
            </div>
            
            <!-- Confetti Container -->
            <div class="confetti-container" id="confetti-container"></div>

            <!-- Speech bubble for mooshika -->
<div class="speech-bubble" id="mooshika-speech" style="display: none;">Squeak! You found me!</div>

<!-- Speech bubble for rock/belly -->
<div class="speech-bubble" id="rock-speech" style="display: none;">Yum! Thank you!</div>

<!-- Celebratory message container -->
<div class="celebration-message" id="celebration-message" style="display: none;">
    Great job!
</div>
            
            <!-- Educational Popup -->
            <div class="popup-overlay" id="popup-overlay">
                <div class="popup-content">
                    <div class="popup-title" id="popup-title">Symbol Discovered!</div>
                    <img src="" alt="Symbol" class="popup-image" id="popup-image">
                    <div class="popup-text" id="popup-text">Information about the symbol will appear here.</div>
                    <button class="close-popup" id="close-popup">Continue Adventure</button>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Game state
const gameState = {
    foundSymbols: {
        modak: false,
        mooshika: false,
        belly: false
    },
    dragElement: null,
    modaksInBasket: 0,
    rockVisible: false,
    rockFeedCount: 0,
    mooshikaFound: false,
    mudMoundClicked: null,
    popupOpen: false
};

// Symbol information
const symbolInfo = {
    modak: {
        title: "Modak - Ganesha's Favorite Sweet",
        image: "/images/icons/symbol-modak-colored.png",
        text: "Modak is Lord Ganesha's favorite sweet! This dumpling-shaped dessert is made with rice flour and filled with coconut and jaggery. It symbolizes the reward of spiritual pursuit and the sweetness of the realized inner self. Ganesha's love for modaks teaches us to enjoy the simple pleasures of life!"
    },
    mooshika: {
        title: "Mooshika - Ganesha's Mouse Vehicle",
        image: "/images/icons/symbol-mooshika-colored.png",
        text: "Mooshika is Lord Ganesha's faithful mouse vehicle! This small creature carries the large elephant-headed god, teaching us about balancing strengths and weaknesses. The mouse represents our ego and desires that need to be controlled, while also symbolizing Ganesha's ability to navigate through small spaces and remove obstacles."
    },
    belly: {
        title: "Ganesha's Belly - Symbol of Abundance",
        image: "/images/icons/symbol-belly-colored.png",
        text: "Ganesha's large belly contains the entire universe! It represents his ability to consume and digest all experiences, both good and bad. The belly symbolizes abundance, prosperity, and the acceptance of all of life's experiences. It teaches us to fully digest our life lessons and hold space for everything that comes our way."
    }
};

// Initialize the game
function initGame() {
    // Initialize drag and drop for modaks
    const modaks = document.querySelectorAll('.modak');
    modaks.forEach(modak => {
        modak.addEventListener('mousedown', dragStart);
        modak.addEventListener('touchstart', dragStart, { passive: false });
    });
    
    // Add event listeners for mud mounds
    const mudMounds = document.querySelectorAll('.mud-mound');
    mudMounds.forEach(mound => {
        mound.addEventListener('click', checkForMooshika);
        mound.addEventListener('touchend', function(e) {
            e.preventDefault();
            checkForMooshika.call(this);
        });
    });
    
    // Add event listener for the basket
    const basket = document.getElementById('basket');
    basket.addEventListener('click', checkBasket);
    
    // Apply pulse animation to basket
    basket.classList.add('pulse');
    
    // Set up event listeners for drop targets
    document.addEventListener('mousemove', drag);
    document.addEventListener('touchmove', drag, { passive: false });
    document.addEventListener('mouseup', drop);
    document.addEventListener('touchend', drop);
    
    // Hide mooshika behind a random mound
    hideMouseBehindRandomMound();
    
    // Add back button functionality
    document.getElementById('back-button').addEventListener('click', function() {
        alert('Back button clicked! In the full game, this would navigate back.');
    });
    
    // Add home button functionality
    document.getElementById('home-button').addEventListener('click', function() {
        alert('Home button clicked! In the full game, this would navigate to the main map.');
    });
    
    // Initialize close popup button
    document.getElementById('close-popup').addEventListener('click', closePopup);
}

// Create confetti
function createConfetti() {
    const confettiContainer = document.getElementById('confetti-container');
    confettiContainer.innerHTML = ''; // Clear any previous confetti
    confettiContainer.style.display = 'block';
    
    const colors = ['#f44336', '#e91e63', '#9c27b0', '#673ab7', '#3f51b5', '#2196f3', '#03a9f4', '#00bcd4', '#009688', '#4CAF50', '#8BC34A', '#CDDC39', '#FFEB3B', '#FFC107', '#FF9800', '#FF5722'];
    
    for (let i = 0; i < 100; i++) {
        const confetti = document.createElement('div');
        confetti.classList.add('confetti');
        confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
        confetti.style.left = Math.random() * 100 + '%';
        confetti.style.top = -10 + 'px';
        confetti.style.width = Math.random() * 10 + 5 + 'px';
        confetti.style.height = Math.random() * 10 + 5 + 'px';
        confetti.style.transform = 'rotate(' + Math.random() * 360 + 'deg)';
        confetti.style.animationDuration = Math.random() * 2 + 2 + 's';
        
        confettiContainer.appendChild(confetti);
    }
    
    // Remove confetti after animation completes
    setTimeout(() => {
        confettiContainer.style.display = 'none';
    }, 4000);
}

// Function to show celebratory messages
function showCelebration(message) {
    const celebrationElement = document.getElementById('celebration-message');
    celebrationElement.textContent = message;
    celebrationElement.style.display = 'block';
    
    // Hide after a few seconds
    setTimeout(() => {
        celebrationElement.style.display = 'none';
    }, 2000);
}

// Show educational popup
function showEducationalPopup(symbolType) {
    // Don't show another popup if one is already open
    if (gameState.popupOpen) return;
    
    const popup = document.getElementById('popup-overlay');
    const title = document.getElementById('popup-title');
    const image = document.getElementById('popup-image');
    const text = document.getElementById('popup-text');
    
    // Set popup content based on symbol type
    if (symbolInfo[symbolType]) {
        title.textContent = symbolInfo[symbolType].title;
        image.src = symbolInfo[symbolType].image;
        text.textContent = symbolInfo[symbolType].text;
    }
    
    // Show popup
    popup.style.display = 'flex';
    gameState.popupOpen = true;
    gameState.currentPopupSymbol = symbolType;
}

// Close popup
function closePopup() {
    const popup = document.getElementById('popup-overlay');
    popup.style.display = 'none';
    gameState.popupOpen = false;
    
    // Update sidebar icon
    if (gameState.currentPopupSymbol) {
        const symbolIcon = document.getElementById('symbol-' + gameState.currentPopupSymbol);
        symbolIcon.style.backgroundImage = 
            `url('/images/icons/symbol-${gameState.currentPopupSymbol}-colored.png')`;
        symbolIcon.classList.add('star-burst');
        
        // Remove animation class after it completes
        setTimeout(() => {
            symbolIcon.classList.remove('star-burst');
        }, 500);
    }
    
    // Check if all games are complete
    checkGameCompletion();
}

// Check if all games are complete
function checkGameCompletion() {
    if (gameState.foundSymbols.modak && gameState.foundSymbols.mooshika && gameState.foundSymbols.belly) {
        // All games are complete
        document.querySelector('.game-instructions').innerHTML = 
            "Congratulations! You've completed all the games!";
        
        // Show celebratory confetti
        createConfetti();
    } else {
        // Some games still need to be completed
        let remainingTasks = [];
        if (!gameState.foundSymbols.modak) remainingTasks.push("collect all modaks");
        if (!gameState.foundSymbols.mooshika) remainingTasks.push("find mooshika");
        if (!gameState.foundSymbols.belly) remainingTasks.push("transform rock to belly");
        
        if (remainingTasks.length > 0) {
            document.querySelector('.game-instructions').innerHTML = 
                `Great job! Still need to: ${remainingTasks.join(" and ")}.`;
        }
    }
}

// Hide mooshika behind a random mud mound
function hideMouseBehindRandomMound() {
    const moundIndex = Math.floor(Math.random() * 5) + 1;
    const mooshika = document.getElementById('mooshika');
    const mound = document.getElementById('mound' + moundIndex);
    
    if (mooshika && mound) {
        // Get computed style to get actual position values
        const moundStyle = window.getComputedStyle(mound);
        const moundTop = parseFloat(moundStyle.top);
        const moundLeft = parseFloat(moundStyle.left);
        
        // Position mooshika relative to the mound
        mooshika.style.top = moundTop + 'px';
        mooshika.style.left = moundLeft + 'px';
    }
}

// Check if the clicked mound contains mooshika
function checkForMooshika() {
    // Don't process if popup is open
    if (gameState.popupOpen) return;
    
    gameState.mudMoundClicked = this;
    const mooshika = document.getElementById('mooshika');
    
    // Get the position of the mound and mooshika
    const moundRect = this.getBoundingClientRect();
    const mooshikaRect = mooshika.getBoundingClientRect();
    
    // Check if the centers are close enough
    const moundCenterX = moundRect.left + moundRect.width / 2;
    const moundCenterY = moundRect.top + moundRect.height / 2;
    const mooshikaCenterX = mooshikaRect.left + mooshikaRect.width / 2;
    const mooshikaCenterY = mooshikaRect.top + mooshikaRect.height / 2;
    
    const distance = Math.sqrt(
        Math.pow(moundCenterX - mooshikaCenterX, 2) + 
        Math.pow(moundCenterY - mooshikaCenterY, 2)
    );
    
    // If the distance is small enough, reveal mooshika
    if (distance < 100) { // Adjusted threshold
        revealMooshika();
    } else {
        this.style.opacity = '0.7'; // Show it's been checked
        setTimeout(() => {
            this.style.opacity = '1'; // Reset opacity after a short delay
        }, 500);
    }
}

// Reveal mooshika when found
function revealMooshika() {
    const mooshika = document.getElementById('mooshika');
    if (mooshika) {
        mooshika.style.visibility = 'visible';
        // Add jumping animation
        mooshika.classList.add('jumping');
        
        gameState.mooshikaFound = true;
        
        // Show speech bubble
        const speechBubble = document.getElementById('mooshika-speech');
        speechBubble.style.display = 'block';
        speechBubble.style.opacity = '1';
        
        // Position the speech bubble above mooshika
        const mooshikaRect = mooshika.getBoundingClientRect();
        const containerRect = document.querySelector('.game-container').getBoundingClientRect();
        speechBubble.style.left = ((mooshikaRect.left + mooshikaRect.width/2) - containerRect.left - speechBubble.offsetWidth/2) + 'px';
        speechBubble.style.top = ((mooshikaRect.top - speechBubble.offsetHeight - 20) - containerRect.top) + 'px';
        
        // Hide speech bubble after a few seconds
        setTimeout(() => {
            speechBubble.style.opacity = '0';
            setTimeout(() => {
                speechBubble.style.display = 'none';
            }, 300);
        }, 3000);
        
        // Show success indicator
        showSuccess();
        
        // Remove the clicked mound
        if (gameState.mudMoundClicked) {
            gameState.mudMoundClicked.style.visibility = 'hidden';
        }
        
        // Show celebratory message
        showCelebration("Yay! You found Mooshika, Ganesha's faithful vehicle!");
        
        // Mark as found
        gameState.foundSymbols.mooshika = true;
        
        // Show educational popup after the celebration
        setTimeout(() => {
            showEducationalPopup('mooshika');
        }, 2500);
    }
}

// Check basket when clicked
function checkBasket() {
    // Don't process if popup is open
    if (gameState.popupOpen) return;
    
    if (gameState.modaksInBasket === 5 && !gameState.rockVisible) {
        // Reveal the rock when 5 modaks are in the basket
        const rockOrBelly = document.getElementById('rock-or-belly');
        rockOrBelly.style.backgroundImage = "url('/images/items/rock.png')";
        rockOrBelly.style.display = 'block';
        rockOrBelly.classList.add('bounce');
        gameState.rockVisible = true;
        
        // Apply pulse animation to the rock
        setTimeout(() => {
            rockOrBelly.classList.add('pulse');
            rockOrBelly.classList.remove('bounce');
        }, 1000);
        
        // Update instructions
        document.querySelector('.game-instructions').innerHTML = 
            "Now feed the rock with modaks from the basket!";
    }
}

// Drag and Drop Functions
function dragStart(e) {
    // Don't process if popup is open
    if (gameState.popupOpen) return;
    
    if (e.type === 'touchstart') {
        e.preventDefault();
        gameState.dragElement = this;
        const touch = e.touches[0];
        gameState.offsetX = touch.clientX - this.getBoundingClientRect().left;
        gameState.offsetY = touch.clientY - this.getBoundingClientRect().top;
    } else {
        gameState.dragElement = this;
        gameState.offsetX = e.clientX - this.getBoundingClientRect().left;
        gameState.offsetY = e.clientY - this.getBoundingClientRect().top;
    }
    
    this.style.opacity = '0.7';
    this.style.zIndex = '1000'; // Bring to front when dragging
}

function drag(e) {
    if (!gameState.dragElement || gameState.popupOpen) return;
    
    e.preventDefault();
    
    let clientX, clientY;
    
    if (e.type === 'touchmove') {
        const touch = e.touches[0];
        clientX = touch.clientX;
        clientY = touch.clientY;
    } else {
        clientX = e.clientX;
        clientY = e.clientY;
    }
    
    // Get container position
    const containerRect = document.querySelector('.game-container').getBoundingClientRect();
    
    // Calculate position relative to container
    const relativeX = clientX - containerRect.left - gameState.offsetX;
    const relativeY = clientY - containerRect.top - gameState.offsetY;
    
    // Keep modak within container bounds
    const modakWidth = gameState.dragElement.offsetWidth;
    const modakHeight = gameState.dragElement.offsetHeight;
    
    const boundedX = Math.max(0, Math.min(containerRect.width - modakWidth, relativeX));
    const boundedY = Math.max(0, Math.min(containerRect.height - modakHeight, relativeY));
    
    gameState.dragElement.style.position = 'absolute';
    gameState.dragElement.style.left = boundedX + 'px';
    gameState.dragElement.style.top = boundedY + 'px';
}

function drop(e) {
    if (!gameState.dragElement || gameState.popupOpen) return;
    
    const basket = document.getElementById('basket');
    const rockOrBelly = document.getElementById('rock-or-belly');
    const modak = gameState.dragElement;
    
    // Get element positions
    const modakRect = modak.getBoundingClientRect();
    const basketRect = basket.getBoundingClientRect();
    
    const modakCenterX = modakRect.left + modakRect.width / 2;
    const modakCenterY = modakRect.top + modakRect.height / 2;
    
    // Check if dropped on basket
    if (modakCenterX > basketRect.left && modakCenterX < basketRect.right &&
        modakCenterY > basketRect.top && modakCenterY < basketRect.bottom) {
        
        // Only count if not already in basket
        if (!modak.dataset.inBasket) {
            gameState.modaksInBasket++;
            modak.dataset.inBasket = "true";
            
            // Update counter
            document.getElementById('modak-counter').textContent = `Modaks: ${gameState.modaksInBasket}/5`;
            
            // Position modaks in a semicircle or grid pattern in the basket
            // rather than stacking them on top of each other
            const basketCenterX = basketRect.left + basketRect.width / 2;
            const basketCenterY = basketRect.top + basketRect.height / 2;
            const containerRect = document.querySelector('.game-container').getBoundingClientRect();
            
            // Position based on how many modaks are already in the basket
            let relativeX, relativeY;
            
            switch(gameState.modaksInBasket) {
                case 1: // Center modak
                    relativeX = (basketCenterX - containerRect.left) - modakRect.width/2;
                    relativeY = (basketCenterY - containerRect.top) - modakRect.height/2;
                    break;
                case 2: // Top left
                    relativeX = (basketCenterX - containerRect.left) - modakRect.width - 5;
                    relativeY = (basketCenterY - containerRect.top) - modakRect.height - 5;
                    break;
                case 3: // Top right
                    relativeX = (basketCenterX - containerRect.left) + 5;
                    relativeY = (basketCenterY - containerRect.top) - modakRect.height - 5;
                    break;
                case 4: // Bottom left
                    relativeX = (basketCenterX - containerRect.left) - modakRect.width - 5;
                    relativeY = (basketCenterY - containerRect.top) + 5;
                    break;
                case 5: // Bottom right
                    relativeX = (basketCenterX - containerRect.left) + 5;
                    relativeY = (basketCenterY - containerRect.top) + 5;
                    break;
            }
            
            // Apply position
            modak.style.left = relativeX + 'px';
            modak.style.top = relativeY + 'px';
            
            // Add bounce animation
            modak.classList.add('bounce');
            setTimeout(() => {
                modak.classList.remove('bounce');
            }, 1000);
            
            // Check if all 5 modaks are collected
            if (gameState.modaksInBasket === 5) {
                // Show success
                showSuccess();
                
                // Show celebratory message
                showCelebration("Amazing! You've collected all the modaks for Ganesha!");
                
                // Automatically show the rock when 5 modaks are collected
                if (!gameState.rockVisible) {
                    const rockOrBelly = document.getElementById('rock-or-belly');
                    rockOrBelly.style.backgroundImage = "url('/images/items/rock.png')";
                    rockOrBelly.style.display = 'block';
                    rockOrBelly.classList.add('bounce');
                    gameState.rockVisible = true;
                    
                    // Apply pulse animation after bounce
                    setTimeout(() => {
                        rockOrBelly.classList.add('pulse');
                        rockOrBelly.classList.remove('bounce');
                    }, 1000);
                    
                    // Update instructions
                    document.querySelector('.game-instructions').innerHTML = 
                        "Now feed the rock with modaks from the basket!";
                }
                
                // Mark as found
                gameState.foundSymbols.modak = true;
                
                // Show educational popup after a short delay
                setTimeout(() => {
                    showEducationalPopup('modak');
                }, 2500);
            }
        }
    }
    
    // Check if the rock is visible and modak is dropped on it
    if (gameState.rockVisible && rockOrBelly.style.display === 'block') {
        const rockRect = rockOrBelly.getBoundingClientRect();
        
        if (modakCenterX > rockRect.left && modakCenterX < rockRect.right &&
            modakCenterY > rockRect.top && modakCenterY < rockRect.bottom) {
            
            // Only count if modak is from basket
            if (modak.dataset.inBasket === "true") {
                gameState.rockFeedCount++;
                
                // Remove this modak with an animation
                modak.classList.add('star-burst');
                setTimeout(() => {
                    modak.style.display = 'none';
                }, 500);
                
                gameState.modaksInBasket--;
                document.getElementById('modak-counter').textContent = `Modaks: ${gameState.modaksInBasket}/5`;
                
                // Rock grows slightly with each feeding
                rockOrBelly.style.transform = `scale(${1 + (gameState.rockFeedCount * 0.05)})`;
                
                // Add increasing glow with each feeding
                rockOrBelly.className = 'rock-or-belly';  // Reset classes
                rockOrBelly.classList.add(`rock-glow-${gameState.rockFeedCount}`);
                
                // Show speech bubble
                const speechBubble = document.getElementById('rock-speech');
                speechBubble.style.display = 'block';
                speechBubble.style.opacity = '1';
                
                // Position the speech bubble above rock
                const rockRect = rockOrBelly.getBoundingClientRect();
                const containerRect = document.querySelector('.game-container').getBoundingClientRect();
                speechBubble.style.left = ((rockRect.left + rockRect.width/2) - containerRect.left - speechBubble.offsetWidth/2) + 'px';
                speechBubble.style.top = ((rockRect.top - speechBubble.offsetHeight - 20) - containerRect.top) + 'px';
                
                // Hide speech bubble after a few seconds
                setTimeout(() => {
                    speechBubble.style.opacity = '0';
                    setTimeout(() => {
                        speechBubble.style.display = 'none';
                    }, 300);
                }, 1500);
                
                // Check if rock has been fed 5 times
                if (gameState.rockFeedCount >= 5) {
                    // Transform rock to belly with animation
                    rockOrBelly.classList.add('star-burst');
                    setTimeout(() => {
                        rockOrBelly.style.backgroundImage = "url('/images/items/belly.png')";
                        rockOrBelly.classList.remove('star-burst');
                        rockOrBelly.classList.add('pulse');
                    }, 500);
                    
                    // Show success
                    showSuccess();
                    
                    // Show celebratory message
                    showCelebration("Hooray! You've transformed the rock into Ganesha's belly!");
                    
                    // Mark as found
                    gameState.foundSymbols.belly = true;
                    
                    // Show educational popup after a short delay
                    setTimeout(() => {
                        showEducationalPopup('belly');
                    }, 2500);
                }
            }
        }
    }
    
    // Reset drag state
    gameState.dragElement.style.opacity = '1';
    gameState.dragElement.style.zIndex = '10'; // Reset z-index
    gameState.dragElement = null;
}

// Show success indicator
function showSuccess() {
    const indicator = document.getElementById('success-indicator');
    indicator.classList.add('show');
    setTimeout(() => {
        indicator.classList.remove('show');
    }, 1500);
}

// Initialize when document is loaded
document.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>
</html>